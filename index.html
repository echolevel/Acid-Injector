<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Acid Injector for STING by IFTAH and the Behringer TD-3</title>
        <style type="text/css">
            body {
                background-color: #1b2227; 
                color: #c0c0c0; 
                font-family:monospace;
                margin: 0 auto;
                width: 800px;
            }

            h1, h3{
                text-align: right;
            }

            input, button, ::-webkit-file-upload-button, select {
                font-family:monospace;
            }

            a {
                color: #8080a0;
                text-decoration: none;
            }
            li {
                padding-bottom:1em;
            }

            pre {
                background-color: #121619;
                color: #6cb079;
                padding: 4px;
            }
            
            footer {
                text-align: right;
            }

        </style>
    </head>
    <body>
        <h1>Acid Injector</h1>

        <h3><a href="https://github.com/echolevel/Acid-Injector">source on github</a></h3>

        <p>
            <h2>tl;dr</h2>
            Converts MIDI clips generated by <strong><a href="https://maxforlive.com/library/device/8357/sting-by-iftah-a-really-nice-acid-line-generator" target="_blank">STING</strong> by <strong>IFTAH</strong></a>
            (free Max For Live device) into .seq pattern dump files so you can use Behringer's <a href="https://www.behringer.com/product.html?modelCode=P0E24" target="_blank">Synthtribe</a> software to send 
            them to your TD-3 (Roland TB-303 clone). It also generates .syx (sysex) files so you can send a pattern to the TD-3 using any sysex librarian software or sysex-friendly DAW such as Reaper.
            
        </p>

        <input type="file" accept=".mid,.midi" id="fileinput" style="display: none;"/>        

        <select name="SequenceLength" id="user_sequencelength">
            <option value=1>1</option>
            <option value=2>2</option>
            <option value=3>3</option>
            <option value=4>4</option>
            <option value=5>5</option>
            <option value=6>6</option>
            <option value=7>7</option>
            <option value=8>8</option>
            <option value=9>9</option>
            <option value=10>10</option>
            <option value=11>11</option>
            <option value=12>12</option>
            <option value=13>13</option>
            <option value=14>14</option>
            <option value=15>15</option>
            <option value=16 selected>16</option>
        </select> Sequence Length
        <br/>
        <br/>
        <select name="Target Pattern Group (sysex only)" id="user_patterngroup">
            <option value=0 selected>I</option>
            <option value=1>II</option>
            <option value=2>III</option>
            <option value=3>IV</option>
        </select> Target Pattern Group (sysex only)
        <br/>
        <select name="Target Pattern Slot (sysex only)" id="user_patternslot">
            <option value=0 selected>A 1</option>
            <option value=1>A 2</option>
            <option value=2>A 3</option>
            <option value=3>A 4</option>
            <option value=4>A 5</option>
            <option value=5>A 6</option>
            <option value=6>A 7</option>
            <option value=7>A 8</option>
            <option value=8>B 1</option>
            <option value=9>B 2</option>
            <option value=10>B 3</option>
            <option value=11>B 4</option>
            <option value=12>B 5</option>
            <option value=13>B 6</option>
            <option value=14>B 7</option>
            <option value=15>B 8</option>
        </select> Target Pattern Slot (sysex only)
        <br/><br/>
        <input type="checkbox" id="user_triplet" />Triplet mode
        <br/><br/>
        
        <input type="button" id="fileinputcustom" onclick="document.getElementById('fileinput').click();" value="Choose MIDI file..."/>
        
        <br/>
        <br/>

        <button id="btnGenerate">Save .seq</button> <button id="sysexGenerate">Save .syx</button>

        <br/><br/>

        <div >
            <pre id="output"></pre>
        </div>

        

        <h2>Usage Notes</h2>
        <p>
            
            <ol>
                <li>
                    Set up the STING Max For Live device on a MIDI track in Ableton Live. If you've got Ableton's Wavetable instrument, there's a preset called Basic 303 Bass that's good for monitoring STING's output;
                    set the STING channel as its MIDI input so you can hear what STING's doing.
                </li>
                <li>
                    Generate an acid line with STING that's disarmingly simplistic and catchy yet also beguilingly hypnotic and understatedly transcendental. This should only take one or two clicks.             
                </li>
                <li>
                    Record the output to any MIDI track (e.g. the one you've got Wavetable on) and trim the resulting clip down until you've got just one loop of the pattern; 16 steps maximum. Consolidate it, then right click the clip and click 'Export MIDI Clip...'                    
                </li>

                <li>
                    Optionally set  preferences for Sequence Length, Target Pattern Group/Slot and Triplet Mode BEFORE loading a MIDI file.
                </li>            

                <li>
                    Click 'Choose MIDI file' below and choose the .mid clip you just exported.
                </li>                
                
                <li>
                    Assuming you don't get any warnings, click 'Save .seq' to generate the Synthtribe pattern file.
                </li>

                <li>
                    Synthtribe will only show you anything useful when your TD-3 is plugged in with USB and switched on, so do that, then go to the Sequencer view.
                </li>

                <li>
                    Click 'Import' to find and load the .seq file you just created. Then click 'Store' to send the pattern to the TD-3, bearing in mind 
                    that the pattern will end up in the Pattern Group, Pattern Section and Pattern slot that you specify in the upper left. 
                </li>         
                                
                <li>
                    If you're using sysex, you can choose a Target Pattern Group/Slot before generating the file. Be careful - uploading to a slot will overwrite whatever's in it!
                </li>
            </ol>
        </p>

       

        <h2>About</h2>

        <p>
            <strong><a href="https://maxforlive.com/library/device/8357/sting-by-iftah-a-really-nice-acid-line-generator" target="_blank">STING</strong> by <strong>IFTAH</strong></a>
             is a <i>really nice</i> acid line generator for Ableton Live (Max For Live device). It generates really nice acid lines for the Roland TB-303.
        </p>

        <p>
            The TD-3 has a function not found in the original 303 which randomly generates a pattern when you press 'Clear' and 'Start/Stop' simultaneously.
            Sounds good, you're thinking! But I'm afraid you're wrong: it is actually bad. I want <i>really nice</i> semi-random acid patterns in my TD-3, not bad ones. 
            Also I'm 10,000 years old and have two jobs and kids and sore knees and no time and I can't be arsed to program <i>really nice</i> patterns myself. 
            I'd rather generate a load of them with STING and transfer them over.
        </p>

        <p>
            <a href="https://www.behringer.com/product.html?modelCode=P0E24" target="_blank">Synthtribe</a> is Behringer's Win/Mac software for various of its hardware synths, including its 303 knock-off the TD-3.
            As well as handling firmware updates via USB MIDI, it sends and receives sysex dumps and even has a little sequence editor of its own built in.
            It's not really nice, but it <i>is</i> pretty simple and reliable. And - surprisingly - it doesn't need to be installed, which means it doesn't litter your system with background processes, updaters and shortcuts.
        </p>

        <p>
            This converter is pure Javascript - lightweight and dependency free - but doesn't really do anything fancy.
            If you export a 16-step MIDI clip from Ableton Live, regardless of tempo (or time signature, probably, but don't go crazy), you can use 
            this converter to generate a .seq file that can be loaded into the Synthtribe software and then sent to your TD-3 via the 'Sequencer' page and 'Store' button; or a sysex file that you 
            can transmit to the TD-3 via lots of free sysex librarian programs and many DAWs.
        </p>

        <p>
            I did this on an unexpected September 2022 bank holiday after a quick google search failed to throw up any results for 
            Behringer's proprietary file format. 
            
            Just my luck: after spending ages picking it apart and figuring out how to reliably write the appropriate
            bytes back to the hardware, I did a better google search and found <a href="https://303patterns.com/" target="_blank">303patterns.com</a>, which has a very nice TD-3 pattern manager that uses Web MIDI and shows you the steps and stuff.
            It also lets you change TD-3 hardware settings, which can be a pain IRL without constant recourse to the manual. Very cool! 
            I had some trouble getting it to work more than once (probably due to the war zone of MIDI drivers, multiclient virtual loopback drivers, and greedy DAWs that exists on my studio computer),
            so I didn't regret having made this (slightly more cumbersome) workflow for achieving similar ends. But if anyone else is looking for 
            detailed sysex implementation info on the TD-3, Brad Isbell has dug deep into it and shared his findings <a href="https://303patterns.com/td3-midi.html" target="_blank">here</a>.

            <br/><br/>
            Anyway, it was a fun project for me. It forced me to learn about the Standard MIDI File format, which I've been putting off for years, and 
            I'll have some use for that knowledge in future - especially calculating PPQN, evaluating timestamp deltas, all sorts of other fun stuff.
            <a href="https://github.com/velipso/basicmidi/blob/master/docs/midi.md" target="_blank">This doc by Sean</a> really helped with that!

        </p>

        <h2>Future</h2>
        <p>
            This is basically finished, unless I've overlooked or fucked up something fundamental that needs fixing. One more thing I might add is 
            some means of quickly constructing (or partially/wholly populating) a Synthtribe .sqs file, which is a full dump of TD-3 patterns with 
            some extra header info that specifies Track/Pattern Group/Pattern Section identifiers for each pattern. I assume that'll work via sysex as well.
            
        </p>

        

        <h2>More notes / troubleshooting</h2>
        <p>
            

            <ul>
                <li>
                    Be sure to consolidate your MIDI clip in Ableton Live before exporting it. Tempo doesn't really matter, and time signature <i>probably doesn't</i>.                    
                </li>

                <li>
                    Using a non-default PPQN <i>may</i> cause problems, especially if variable-length timing delta bytes become huge. Shouldn't usually be a problem in Live, however, and Sting is a Max For Live device so [shrug??].
                    To be honest, changing Ableton Live's default PPQN is either difficult or impossible, so this shouldn't be a concern.                    
                </li>

                <li>
                    Saving more than 16 equally spaced steps (or any number of unequally spaced steps) will cause problems. Or maybe fun surprises! But yeah, more likely problems. 
                    We're here to convert Really Nice Acid Lines; if you want a bunch of random shit in your pattern, just hit 'Clear' and 'Start/Stop' :)
                </li>

                <li>
                    Triplet: I don't think STING does triplets, or can be made to do so (correct me if I'm wrong). You can set it yourself if you fancy, but remember this limits maximum sequence length to 15 (multiple of 3, innit).
                    The extra pitch step will be sent to the TD-3, but you won't hear it.
                </li>

                <li>
                    I don't <i>really</i> handle tied notes, for good but extremely boring reasons. The 303 (and feature-accurate clones) deals with 
                    tied notes by inserting a gap in the sequence and 'pushing' excess notes off the end. I don't know whether, internally to the hardware,
                    those excess notes are lost forever or still exist in the pitch/rest structure to be restored if the tied note is removed. 
                    I <i>think</i> that in my direction (MIDI DAW->sysex->hardware) ties sort of...don't exist, because all I can do is convert the MIDI notes 
                    that the DAW hands to me. When I add ties to my binary Synthtribe seems to parse them and inject the gap itself, perhaps just so it can visually
                    depict how the sequence will 'look' on the TD-3; perhaps it is indeed sending the unmolested pattern to the hardware along with the tied-note bit maps.
                    Who knows? (If you know, and if you care, let <i>me</i> know and maybe I can do something about it)
                </li>
            </ul>
        </p>

        <br/><br/><br/>

        <footer>
            <a href="https://echolevel.co.uk" target="_blank">echolevel</a> | <a href="https://twitter.com/echolevel" target="_blank">twitter</a> | <a href="https://github.com/echolevel" target="_blank">github</a><br/>
        </footer>
        

       <br/><br/><br/>

        <script src="./script.js" type="text/javascript"></script>
    </body>

</html>
</html>